<div ng-include="'html/studentTabs.html'"></div>
<div class="voffset4">
    <div id="student-ieps-select" class="input-group">
        <span class="input-group-addon">IEP Goal</span>
        <div class="input-group-btn">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ selectedIep.title }} <span class="caret"></span></button>
            <ul class="dropdown-menu dropdown-menu-right">
                <li ng-repeat="entry in ieps" ng-click="selectIep(entry)" ng-class="{ 'active': entry.id === selectedIep.id, }">
                    <a class="student-overview-assign-link">{{ entry.title }}  <span ng-if="entry.id === selectedIep.id" class="glyphicon glyphicon-ok"></span></a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="voffset4" ng-repeat="iep in ieps" ng-if="iep.id === selectedIep.id">
    <!-- chart -->
    <div class="row" ng-if="iep.quantitative">
        <div class="col-xs-12">
            <div class="panel-wrapper">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Progress</h4>
                    </div>
                    <div class="panel-body">
                        <!-- chart goes here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- measurements -->
    <div class="row">
        <div class="col-xs-12">
            <div class="panel-wrapper">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Measurements</h4>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="table-responsive table-select">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th class="student-ieps-tiny-col">Date</th>
                                                <th class="student-ieps-tiny-col" ng-show="iep.quantitative">Score</th>
                                                <th>Note</th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="editable-row" ng-repeat="data in iep.datapoints" ng-click="toggleEditData(data, true)">
                                                <td class="student-ieps-tiny-col" ng-show="!data.editing">{{ data.date.format('YYYY-MM-DD') }}</td>
                                                <td class="student-ieps-tiny-col" ng-show="!data.editing && iep.quantitative">{{ data.value }}</td>
                                                <td ng-show="!data.editing">{{ data.note }}</td>
                                                <td class="student-ieps-min-col" ng-show="!data.editing">
                                                    <span class="glyphicon glyphicon-pencil pencilEdit student-ieps-hover-pencil"></span>
                                                </td>
                                                <td class="student-ieps-min-col table-button-col" ng-show="!data.editing">
                                                    <button class="btn btn-danger btn-xs pull-right" type="button" ng-click="deleteData(data)">
                                                        <span class="glyphicon glyphicon-trash"></span>
                                                    </button>
                                                </td>
                                                <td class="student-ieps-tiny-col" ng-show="data.editing">
                                                    <input autocomplete="off" type="text" date-time class="form-control" ng-model="data.date_temp" view="date" min-view="date" format="YYYY-MM-DD" required>
                                                </td>
                                                <td class="student-ieps-tiny-col" ng-show="data.editing && iep.quantitative">
                                                    <input type="text" class="form-control" ng-model="data.value_temp" ng-class="{ 'ng-invalid': dataValueValidation(iep, data), }">
                                                </td>
                                                <td ng-show="data.editing">
                                                    <input type="text" class="form-control" ng-model="data.note_temp">
                                                </td>
                                                <td class="student-ieps-min-col" ng-show="data.editing">
                                                    <button class="btn btn-success" type="button" ng-disabled="dataValidation(iep, data)" ng-click="saveData(data); $event.stopPropagation();">
                                                        Save
                                                    </button>
                                                </td>
                                                <td class="student-ieps-min-col" ng-show="data.editing">
                                                    <button class="btn btn-danger" type="button" ng-click="toggleEditData(data, false); $event.stopPropagation();">
                                                        Cancel
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- click to add data panel -->
                        <div class="btn-manipulate-row">
                            <button class="btn btn-success" ng-if="!iep.addingData" ng-click="toggleAddData(iep, true)">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </div>
                        <!-- add data panel -->
                        <div class="row voffset3" ng-if="iep.addingData">
                            <div class="col-xs-12">
                                <div class="panel-wrapper">
                                    <div class="panel panel-default no-bottom-margin">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">Add Measurement</h4>
                                        </div>
                                        <div class="panel-body">
                                            <form class="form-horizontal" name="addDataForm{{$index}}" ng-submit="addData(iep)">
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">Date: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" date-time ng-model="iep.newData.date" view="date" min-view="date" format="YYYY-MM-DD" required>
                                                    </div>
                                                </div>
                                                <div class="form-group" ng-if="iep.quantitative">
                                                    <label class="control-label col-sm-2">Score: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" ng-model="iep.newData.value" ng-class="{ 'ng-invalid': dataNewValueValidation(iep, iep.newData), }" ng-required="iep.quantitative">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">Note: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" ng-model="iep.newData.note">
                                                    </div>
                                                </div>
                                                <div class="form-group no-bottom-margin">
                                                    <div class="col-sm-offset-2 col-sm-10">
                                                        <button class="btn btn-success" ng-disabled="addDataForm{{$index}}.$invalid || dataNewValueValidation(iep, iep.newData)" type="submit">Add</button>
                                                        <button class="btn btn-danger" ng-click="toggleAddData(iep, false)">Cancel</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- notes -->
    <div class="row voffset3">
        <div class="col-xs-12">
            <div class="panel-wrapper">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Notes</h4>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="table-responsive table-select">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th class="student-ieps-tiny-col">Date</th>
                                                <th>Note</th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="editable-row" ng-repeat="note in iep.notes" ng-click="toggleEditNote(note, true)">
                                                <td class="student-ieps-tiny-col" ng-show="!note.editing">{{ note.date.format('YYYY-MM-DD') }}</td>
                                                <td ng-show="!note.editing">
                                                    <div ng-if="note.title && note.title.length > 0">
                                                        <span class="student-ieps-note-title">{{ note.title }}</span>
                                                    </div>
                                                    <div ng-if="note.body && note.body.length > 0">
                                                        <span>"{{ note.body }}"</span>
                                                    </div>
                                                </td>
                                                <td class="student-ieps-min-col" ng-show="!note.editing">
                                                    <span class="glyphicon glyphicon-pencil pencilEdit student-ieps-hover-pencil"></span>
                                                </td>
                                                <td class="student-ieps-min-col table-button-col" ng-show="!note.editing">
                                                    <button class="btn btn-danger btn-xs pull-right" type="button" ng-click="deleteNote(note)">
                                                        <span class="glyphicon glyphicon-trash"></span>
                                                    </button>
                                                </td>
                                                <td class="student-ieps-tiny-col" ng-show="note.editing">
                                                    <input autocomplete="off" type="text" date-time class="form-control" ng-model="note.date_temp" view="date" min-view="date" format="YYYY-MM-DD" required>
                                                </td>
                                                <td ng-show="note.editing">
                                                    <div>
                                                        <input type="text" class="form-control" ng-model="note.title_temp" required>
                                                    </div>
                                                    <div>
                                                        <input type="text" class="form-control student-ieps-note-spacer" ng-model="note.body_temp" required>
                                                    </div>
                                                </td>
                                                <td class="student-ieps-min-col" ng-show="note.editing">
                                                    <button class="btn btn-success" type="button" ng-disabled="noteValidation(note)" ng-click="saveNote(note); $event.stopPropagation();">
                                                        <span>Save</span>
                                                    </button>
                                                </td>
                                                <td class="student-ieps-min-col" ng-show="note.editing">
                                                    <button class="btn btn-danger" type="button" ng-click="toggleEditNote(note, false); $event.stopPropagation();">
                                                        <span>Cancel</span>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- click to add note panel -->
                        <div class="btn-manipulate-row">
                            <button class="btn btn-success" ng-if="!iep.addingNote" ng-click="toggleAddNote(iep, true)">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </div>
                        <!-- add note panel -->
                        <div class="row voffset3" ng-if="iep.addingNote">
                            <div class="col-xs-12">
                                <div class="panel-wrapper">
                                    <div class="panel panel-default no-bottom-margin">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">Add Note</h4>
                                        </div>
                                        <div class="panel-body">
                                            <form class="form-horizontal" name="addNoteForm{{$index}}" ng-submit="addNote(iep)">
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">Date: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" date-time ng-model="iep.newNote.date" view="date" min-view="date" format="YYYY-MM-DD" required>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">Title: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" ng-model="iep.newNote.title" required>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">Note: </label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" ng-model="iep.newNote.body" required>
                                                    </div>
                                                </div>
                                                <div class="form-group no-bottom-margin">
                                                    <div class="col-sm-offset-2 col-sm-10">
                                                        <button class="btn btn-success" ng-disabled="addNoteForm{{$index}}.$invalid" type="submit">Add</button>
                                                        <button class="btn btn-danger" ng-click="toggleAddNote(iep, false)">Cancel</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- info -->
    <div class="row voffset3">
        <div class="col-xs-12">
            <div id="student-ieps-edit-form" class="panel-wrapper">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">IEP Info</h4>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <form class="form-horizontal" name="editIepForm{{$index}}" ng-submit="saveIep(iep)">
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Title: </label>
                                    <div class="col-sm-10">
                                        <p class="form-control-static" ng-if="!iep.editing">{{ iep.title }}</p>
                                        <div ng-if="iep.editing">
                                            <input type="text" class="form-control" ng-model="iep.title_temp" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Due Date: </label>
                                    <div class="col-sm-10">
                                        <p class="form-control-static" ng-if="!iep.editing">{{ iep.due_date.format('YYYY-MM-DD') }}</p>
                                        <div ng-if="iep.editing">
                                            <input autocomplete="off" type="text" date-time class="form-control" ng-model="iep.due_date_temp" view="date" min-view="date" format="YYYY-MM-DD" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group no-bottom-margin">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <div ng-if="iep.editing">
                                            <button class="btn btn-success" type="submit" ng-disabled="editIepForm{{$index}}.$invalid">
                                                <span>Save</span>
                                            </button>
                                            <button class="btn btn-danger" ng-click="toggleEditIep(iep, false)">
                                                <span>Cancel</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="btn-manipulate-row">
                            <button class="btn btn-primary" ng-if="!iep.editing" ng-click="toggleEditIep(iep, true)">
                                <span class="glyphicon glyphicon-pencil"></span>
                            </button>
                            <button class="btn btn-danger" ng-if="iep.editing" ng-click="deleteIep(iep)">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div ng-include="'html/bottomSpacer.html'"></div>

